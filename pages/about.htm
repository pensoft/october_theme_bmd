url = "/about"
layout = "default"
title = "About"
is_hidden = 0
meta_description = "about page"
seo_keywords = "keywords"
robot_index = "index"
robot_follow = "follow"

[siteSearchInclude]

[jumbotron about-what-we-do]
jumbotron = "about-what-we-do"
templates = "template3"
background = transparent
description_limit = 0

[jumbotron about-why-we-do]
jumbotron = "about-why-we-do"
templates = "template3"
background = transparent
description_limit = 0

[jumbotron about-achieving-these-targets-requires]
jumbotron = "about-achieving-these-targets-requires"
templates = "template3"
background = transparent
description_limit = 0

[jumbotron about-how-we-do-intro]
jumbotron = "about-how-we-do-intro"
templates = "template3"
background = transparent
description_limit = 0

==
<?php
function onStart(){
    use Pensoft\Accordions\Models\Item;
    use Pensoft\Accordions\Models\Category;
    use Pensoft\Partners\Models\Partners as Partner;
    use Pensoft\CardProfiles\Models\Profiles as Profile;
    use Pensoft\CardProfiles\Models\Category as ProfileCategory;

    $this['mission_title'] = Category::where('slug', 'objectives')->first();
    $this['mission_records'] = Item::whereHas('accordion', function($query) {
        $query->where('slug', 'objectives');
    })->get();
    
    $this['work_packages_title'] = Category::where('slug', 'wp')->first();
    $this['work_packages_records'] = Item::whereHas('accordion', function($query) {
        $query->where('slug', 'wp');
    })->get();

    $this['partners'] = Partner::where('type', 2)->get();
    $this['parner_profiles'] = Profile::where('category_id', 1)->get();
    
    $partnersWithMembers = [];
    foreach ($this['partners'] as $partner) {
        $members = Profile::where('partner_id', $partner->id)->get();
        $partnersWithMembers[$partner->id] = $members;
    }
    $this['partnersWithMembers'] = $partnersWithMembers;

    // External Expert Advisory Board profiles (isolated from existing logic)
    $eabCategory = ProfileCategory::where('slug', 'external-expert-advisory-board')
        ->orWhere('name', 'External Expert Advisory Board')
        ->first();
    $this['eab_profiles'] = [];
    if ($eabCategory) {
        $this['eab_profiles'] = Profile::with(['partner'])
            ->where('category_id', $eabCategory->id)
            ->orderBy('sort_order')
            ->get();
    }
}
?>
==
{% component 'siteSearchInclude' %}

<section class="container-fluid about-tabs">
    <div class="container">
        <div class="row tabs-row">
            <div class="tabs">
                <a href="#what-we-do" class="tab-link active" data-tab="what-we-do">What we do</a>
                <a href="#why-we-do" class="tab-link" data-tab="why-we-do">Why we do it</a>
                <a href="#how-we-do" class="tab-link" data-tab="how-we-do">How we do it</a>
                <a href="#who-we-are" class="tab-link" data-tab="who-we-are">Who we are</a>
            </div>
        </div>
    </div>
</section>

<section class="container-fluid what-we-do tab-content active" id="what-we-do">
    {% component 'about-what-we-do' %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <h2 class="about-header">Objectives</h2>
            </div>
            <div class="col-xs-12">
                {% for objective in mission_records %}
                    <div class="objective-item">
                        <div class="objective-head row" role="button" aria-expanded="false">
                            <div class="col-md-11 col-xs-10 objective-text">
                                {{ objective.title }}
                            </div>
                            <div class="col-md-1 col-xs-2">
                                <div class="objective-arrow" aria-hidden="true">
                                    <img src="{{'assets/images/chevron-down.svg'|theme}}" alt="" class="chevron-icon">
                                </div>
                            </div>
                        </div>
                        <div class="objective-content">
                            {{ objective.body|raw }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<section class="container-fluid why-we-do tab-content" id="why-we-do">
    {% component 'about-why-we-do' %}
    {% component 'about-achieving-these-targets-requires' %}
</section>

<section class="container-fluid how-we-do tab-content" id="how-we-do">
    {% component 'about-how-we-do-intro' %}
    
    <div class="container work-packages" id="work-packages">
        {% for work_package in work_packages_records %}
            <div class="work-package key_{{ loop.index0 }}">
                <div class="work-package-header row" role="button" aria-expanded="false">
                    <div class="col-md-1 prefix col-xs-3">
                        <div class="prefix-number">{{ work_package.prefix }}</div>
                    </div>
                    <div class="col-md-10 title col-xs-8">
                        <h3>{{ work_package.title }}</h3>
                    </div>
                    <div class="col-md-1 col-xs-1 end-xs end-md">
                        <div class="work-package-arrow" aria-hidden="true">
                            <img src="{{'assets/images/chevron-down.svg'|theme}}" alt="" class="chevron-icon">
                        </div>
                    </div>
                </div>
                <div class="work-package-content" style="display:none;">
                    <div class="work-package-body">
                        {{ work_package.body|raw }}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</section>

<section class="container-fluid who-we-are tab-content" id="who-we-are">
    <div class="container">
        <div class="row">
            {% for c in partners %}
            <div class="col-md-2 col-sm-3 col-xs-6 partner-logo">
                <a href="#" class="partner-trigger" data-partner-id="{{ c.id }}" data-partner-name="{{ c.instituion }}">
                    <img alt="{{ c.instituion }}" title="{{ c.instituion }}" src="{{c.cover.thumb(auto,80,{'mode':'crop'})}}">
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="container">
        <div class="col-xs-12 text-center">
            <h2 class="section-header">External Expert Advisory Board</h2>
        </div>
        <div class="row eab-profiles">
            {% for p in eab_profiles %}
            <div class="col-md-3 col-xs-12 eab-profile">
                <div class="eab-card">
                    {% if p.partner and p.partner.cover %}
                    <div class="eab-partner-logo">
                        <img alt="{{ p.partner.instituion }}" title="{{ p.partner.instituion }}" src="{{ p.partner.cover.thumb(72,40,{'mode':'crop'}) }}">
                    </div>
                    {% endif %}

                    <div class="eab-image">
                        {% if p.avatar %}
                        <img alt="{{ p.names }}" title="{{ p.names }}" src="{{ p.avatar.thumb(600,360,{'mode':'crop'}) }}">
                        {% else %}
                        <div class="eab-image-placeholder"></div>
                        {% endif %}
                    </div>

                    <div class="eab-card-footer row middle-xs between-xs">
                        <div class="col-xs-7 eab-name">{{ p.names }}</div>
                        <div class="col-xs-5 end-xs">
                            <a href="#" class="eab-biography-toggle" aria-expanded="false">
                                <span>Biography</span>
                                <svg class="chevron" width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path d="M1 1L5 5L9 1" stroke="#20A683" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- {% if p.position %}
                    <div class="eab-position">{{ p.position }}</div>
                    {% endif %} -->

                    <div class="eab-bio" style="display:none;">
                        {{ p.content|raw ?: p.body|raw }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Include Partners Popup -->
{% partial 'components/partners-popup' partners=partners partnersWithMembers=partnersWithMembers %}
